import { Injectable } from '@angular/core';
import world from '../../../../assets/geojson/world.geo.json';

@Injectable()
export class WorldGeoJsonService {
  private worldGeoJson: Object;

  getWorldGeoJson(countryData: Array<{ country: string; count: number }>): Object {
    this.formatGeoJson(countryData);
    return this.worldGeoJson;
  }

  private formatGeoJson(countryData: Array<{ country: string; count: number }>): void {
    this.worldGeoJson = {
      ...world,
      // @ts-ignore
      features: world.features.map((f) => {
        const country =
          f.properties.iso_a2 !== '-99' ? f.properties.iso_a2 : f.properties.iso_a2_eh;
        return {
          type: f.type,
          properties: {
            country,
            name: f.properties.name,
            score: this.getCountryScore(country, countryData)
          },
          geometry: f.geometry
        };
      })
    };
  }

  private getCountryScore(
    country: string,
    countryData: Array<{ country: string; count: number }>
  ): number {
    if (countryData.some((d) => d.country === country)) {
      return countryData.find((d) => d.country === country).count;
    }

    return 0;
  }
}
