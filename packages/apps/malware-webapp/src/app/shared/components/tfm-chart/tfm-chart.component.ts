import { Component, EventEmitter, Input, OnChanges, Output } from '@angular/core';
import { ECharts, EChartsOption } from 'echarts';

@Component({
  selector: 'tfm-chart',
  templateUrl: './tfm-chart.component.html',
  styleUrls: ['./tfm-chart.component.sass']
})
export class TfmChartComponent implements OnChanges {
  @Input() options: EChartsOption;

  @Output() onLegendSelectionChanges = new EventEmitter();

  chartOpts: EChartsOption;
  chart: ECharts;

  ngOnChanges(): void {
    if (this.options != null) {
      this.chartOpts = {
        ...this.options,
        title: {},
        textStyle: this.getTextStyle(),
        legend: {
          ...this.options.legend,
          textStyle: this.getTextStyle(),
          align: 'auto',
          bottom: 0,
          padding: 0
        },
        grid: {
          width: this.options.dataZoom != null ? '90%' : '100%',
          left: 0,
          right: 0,
          top: 0,
          bottom: 40,
          containLabel: true
        }
      };
    }
  }

  onChartInit(e: ECharts) {
    this.chart = e;
    this.chart.on('legendselectchanged', (event: any) => {
      this.onLegendSelectionChanges.emit(event.selected);
    });
  }

  private getTextStyle() {
    return {
      fontFamily: 'Ysabeau',
      color: '#6e6e6e'
    };
  }
}
