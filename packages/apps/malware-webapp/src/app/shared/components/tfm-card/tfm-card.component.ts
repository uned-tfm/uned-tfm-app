import { AfterViewInit, Component, Input } from '@angular/core';
import * as L from 'leaflet';
import { MapService } from '@app/shared/services/map/map.service';
import { findMalwareEvolutionByCountry } from '../../../../../dependencies/use-cases/malware-evolution';
import { isNil } from '@core/utils/type-checkers';

@Component({
  selector: 'tfm-card',
  templateUrl: './tfm-card.component.html',
  styleUrls: ['./tfm-card.component.sass']
})
export class TfmCardComponent implements AfterViewInit {
  @Input() title: string;
  @Input() mapId: string;

  private map: L.Map;

  constructor(private readonly mapService: MapService) {}

  async ngAfterViewInit(): Promise<void> {
    let countryData = await findMalwareEvolutionByCountry();
    countryData = countryData.filter((d) => !isNil(d.country));

    this.map = this.mapService.createNewMapInstanceAnimated(this.mapId, countryData, {
      zoomControl: false,
      doubleClickZoom: false,
      closePopupOnClick: false,
      trackResize: false,
      touchZoom: false,
      scrollWheelZoom: false
    });
  }
}
