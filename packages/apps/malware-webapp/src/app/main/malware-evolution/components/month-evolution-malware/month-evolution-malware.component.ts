import { Component, OnInit } from '@angular/core';
import { EChartsOption } from 'echarts';
import { findMalwareEvolutionByMonth } from '../../../../../../dependencies/use-cases/malware-evolution';

@Component({
  selector: 'tfm-month-evolution-malware',
  templateUrl: './month-evolution-malware.component.html',
  styleUrls: ['./month-evolution-malware.component.sass']
})
export class MonthEvolutionMalwareComponent implements OnInit {
  monthEvolutionOpts: EChartsOption;

  async ngOnInit(): Promise<void> {
    await this.initMonthSummaryChart();
  }

  formatNumber(num: number): string {
    return new Intl.NumberFormat('ES-es').format(num);
  }

  private async initMonthSummaryChart(): Promise<void> {
    const monthEvolution = await findMalwareEvolutionByMonth();

    this.monthEvolutionOpts = {
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'shadow'
        }
      },
      legend: {},
      grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
      },
      xAxis: {
        type: 'category',
        data: [
          'Enero',
          'Febrero',
          'Marzo',
          'Abril',
          'Mayo',
          'Junio',
          'Julio',
          'Agosto',
          'Septiembre',
          'Octubre',
          'Noviembre',
          'Diciembre'
        ]
      },
      yAxis: { name: 'Income' },
      series: [
        {
          name: '2020',
          type: 'line',
          data: [null, ...monthEvolution.filter((d) => d.year === 2020).map((data) => data.count)]
        },
        {
          name: '2021',
          type: 'line',
          data: monthEvolution.filter((d) => d.year === 2021).map((data) => data.count)
        },
        {
          name: '2022',
          type: 'line',
          data: monthEvolution.filter((d) => d.year === 2022).map((data) => data.count)
        },
        {
          name: '2023',
          type: 'line',
          data: monthEvolution.filter((d) => d.year === 2023).map((data) => data.count)
        }
      ],
      color: ['rgb(215,25,28)', 'rgb(253,174,97)', 'rgb(171,221,164)', 'rgb(43,131,186)']
    };
  }
}
