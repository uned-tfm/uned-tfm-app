import { AfterViewInit, Component } from '@angular/core';
import * as L from 'leaflet';
import { MapService } from '@app/shared/services/map/map.service';
import { findMalwareEvolutionByCountry } from '../../../../../../dependencies/use-cases/malware-evolution';
import { isNil } from '@core/utils/type-checkers';

@Component({
  selector: 'tfm-country-evolution-malware',
  templateUrl: './country-evolution-malware.component.html',
  styleUrls: ['./country-evolution-malware.component.sass']
})
export class CountryEvolutionMalwareComponent implements AfterViewInit {
  private map: L.Map;
  mapId = 'map1';

  constructor(private readonly mapService: MapService) {}

  async ngAfterViewInit(): Promise<void> {
    let countryData = await findMalwareEvolutionByCountry();
    countryData = countryData.filter((d) => !isNil(d.country));

    this.map = this.mapService.createNewMapInstanceAnimated(this.mapId, countryData, {
      zoomControl: false,
      doubleClickZoom: false,
      closePopupOnClick: false,
      trackResize: false,
      touchZoom: false,
      scrollWheelZoom: false
    });
  }
}
